<div class="container-user">
  <div class="content-user mx-auto card rounded-3">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="form-title">{{title}}</h4>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.close()"></button>
    </div>

    <form class="mt-2 card-body" [formGroup]="formData" (ngSubmit)="fnSubmit()">
      <div class="card p-3 mb-3">
        <legend class="fz-1 form-subtitle">Datos Cuenta</legend>
        <div class="row">
          <div class="form-floating mb-3 col-sm-6">
            <input type="text" class="form-control" id="dni" placeholder="" formControlName="dni" />
            <label for="dni" class="ms-1">C&eacute;dula</label>

            <div *ngIf="
                  formData.controls['dni'].invalid &&
                  (formData.controls['dni'].dirty ||
                    formData.controls['dni'].touched)
                " class="form-text text-danger">
              <div *ngFor="let validation of validMessage.cedula">
                <div style="font-size: smaller !important" *ngIf="
                      formData.get('dni')?.hasError(validation.type) &&
                      (formData.get('dni')?.dirty ||
                        formData.get('dni')?.touched)
                    ">
                  {{ validation.message }}
                </div>
              </div>


              <div style="font-size: smaller !important" *ngIf="
                        formData.get('dni')?.hasError('alreadyExist') &&
                        (formData.get('dni')?.dirty ||
                          formData.get('dni')?.touched)
                      ">
                {{ formData.get("dni")?.getError("alreadyExist") }}
              </div>
              <div style="font-size: smaller !important" *ngIf="
                formData.get('dni')?.hasError('incorrectDni') &&
                (formData.get('dni')?.dirty ||
                  formData.get('dni')?.touched)
              ">
                {{ formData.get("dni")?.getError("incorrectDni") }}
              </div>
            </div>
          </div>

          <!-- <div class="form-floating mb-3 col-sm-6">
            <select class="form-select form-select-sm" aria-label=".form-select-lg example"  id="roles" formControlName="roles">
              <option value="{{ envi.key }}" *ngFor="let envi of getRoles | keyvalue" selected>
                {{ envi.value }}
              </option>
            </select>
            <label for="roles" class="ms-1">Rol</label>
          </div> -->

          <div class="form-floating mb-3 col-sm-6">
            <input type="text" class="form-control" id="name" placeholder="" formControlName="name" />
            <label for="name" class="ms-1">Nombres</label>
            <div *ngIf="
                  formData.controls['name'].invalid &&
                  (formData.controls['name'].dirty ||
                    formData.controls['name'].touched)
                " class="form-text text-danger">
              <div *ngFor="let validation of validMessage.name">
                <div style="font-size: smaller !important" *ngIf="
                      formData.get('name')?.hasError(validation.type) &&
                      (formData.get('name')?.dirty ||
                        formData.get('name')?.touched)
                    ">
                  {{ validation.message }}
                </div>
              </div>
            </div>
          </div>

          <div class="form-floating mb-3 col-sm-6">
            <input type="password" class="form-control" id="password" placeholder="" formControlName="password" />
            <label for="password" class="ms-1">Contraseña</label>

            <div *ngIf="
                  formData.controls['password'].invalid &&
                  (formData.controls['password'].dirty ||
                    formData.controls['password'].touched)
                " class="form-text text-danger">
              <div *ngFor="let validation of validMessage.password">
                <div style="font-size: smaller !important" *ngIf="
                      formData.get('password')?.hasError(validation.type) &&
                      (formData.get('password')?.dirty ||
                        formData.get('password')?.touched)
                    ">
                  {{ validation.message }}
                </div>
              </div>
            </div>
          </div>

          <div class="form-floating mb-3 col-sm-6">
            <input type="password" class="form-control" id="repeatPassword" placeholder=""
              formControlName="repeatPassword" />
            <label for="repeatPassword" class="ms-1">Repetir Contraseña</label>

            <div *ngIf="
                  formData.controls['repeatPassword'].invalid &&
                  (formData.controls['repeatPassword'].dirty ||
                    formData.controls['repeatPassword'].touched)
                " class="form-text text-danger">
              <div *ngFor="let validation of validMessage.repeatPassword">
                <div style="font-size: smaller !important" *ngIf="
                      formData.get('repeatPassword')?.hasError(validation.type) &&
                      (formData.get('repeatPassword')?.dirty ||
                        formData.get('repeatPassword')?.touched)
                    ">
                  {{ validation.message }}
                </div>
              </div>

              <div style="font-size: smaller !important" *ngIf="
              formData.get('repeatPassword')?.hasError('mismatch') &&
              (formData.get('repeatPassword')?.dirty ||
                formData.get('repeatPassword')?.touched)
            ">
                {{ formData.get("repeatPassword")?.getError("mismatch") }}
              </div>
            </div>
          </div>
          <div class="form-floating col-sm-6" *ngIf="ideUserEdit">
            <div class="form-check mb-3 col-sm-12">
              <input class="form-check-input"
              id="editarPassword"
              (change)="editarPassword($event)"
              type="checkbox">
              <label class="form-check-label" for="editarPassword">
              Editar Contraseña
              </label>
            </div>
          </div>

        </div>
      </div>

      <!-- Seccion Datos Personales -->
      <div class="accordion  mb-3" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              Datos Personales
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
            data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <div class="row">
                <div class="form-floating mb-3 col-sm-6">
                  <input type="email" class="form-control" id="email" placeholder="" formControlName="email" />
                  <label for="email" class="ms-1">Email</label>
                  <div *ngIf="
                        formData.controls['email'].invalid &&
                        (formData.controls['email'].dirty ||
                          formData.controls['email'].touched)
                      " class="form-text text-danger">
                    <div *ngFor="let validation of validMessage.email">
                      <div style="font-size: smaller !important" *ngIf="
                            formData.get('email')?.hasError(validation.type) &&
                            (formData.get('email')?.dirty ||
                              formData.get('email')?.touched)
                          ">
                        {{ validation.message }}
                      </div>
                    </div>

                    <div style="font-size: smaller !important" *ngIf="
              formData.get('email')?.hasError('alreadyExist') &&
              (formData.get('email')?.dirty ||
                formData.get('email')?.touched)
            ">
                      {{ formData.get("email")?.getError("alreadyExist") }}
                    </div>

                  </div>
                </div>

                <div class="form-floating mb-3 col-sm-6">
                  <input type="text" class="form-control" id="address" placeholder="" formControlName="address" />
                  <label for="address" class="ms-1">Direcci&oacute;n</label>

                  <div *ngIf="
                        formData.controls['address'].invalid &&
                        (formData.controls['address'].dirty ||
                          formData.controls['address'].touched)
                      " class="form-text text-danger">
                    <div *ngFor="let validation of validMessage.address">
                      <div style="font-size: smaller !important" *ngIf="
                            formData.get('address')?.hasError(validation.type) &&
                            (formData.get('address')?.dirty ||
                              formData.get('address')?.touched)
                          ">
                        {{ validation.message }}
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-floating mb-3 col-sm-6">
                  <input type="text" class="form-control" id="phone" placeholder="" formControlName="phone" />
                  <label for="phone" class="ms-1">Tel&eacute;fono</label>

                  <div *ngIf="
                        formData.controls['phone'].invalid &&
                        (formData.controls['phone'].dirty ||
                          formData.controls['phone'].touched)
                      " class="form-text text-danger">
                    <div *ngFor="let validation of validMessage.phone">
                      <div style="font-size: smaller !important" *ngIf="
                            formData.get('phone')?.hasError(validation.type) &&
                            (formData.get('phone')?.dirty ||
                              formData.get('phone')?.touched)
                          ">
                        {{ validation.message }}
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-floating mb-3 col-sm-6">
                  <input type="date" class="form-control" id="born" placeholder="" formControlName="born" />
                  <label for="born" class="ms-1">Fecha Nacimiento</label>

                  <div *ngIf="
                        formData.controls['born'].invalid &&
                        (formData.controls['born'].dirty ||
                          formData.controls['born'].touched)
                      " class="form-text text-danger">
                    <div *ngFor="let validation of validMessage.born">
                      <div style="font-size: smaller !important" *ngIf="
                            formData.get('born')?.hasError(validation.type) &&
                            (formData.get('born')?.dirty ||
                              formData.get('born')?.touched)
                          ">
                        {{ validation.message }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- seccion perfiles -->

      <div class="accordion" id="accordionExamplePerfiles">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwoPerfil">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapsePerfil" aria-expanded="false" aria-controls="collapsePerfil">
              Configuraci&oacute;n Perfiles
            </button>
          </h2>
          <div id="collapsePerfil" class="accordion-collapse collapse" aria-labelledby="headingTwoPerfil"
            data-bs-parent="#accordionExamplePerfiles">
            <div class="accordion-body">
              <div class="row">
                <div class="form-check mb-3 col-sm-6"  *ngFor="let item of perfiles">
                  <input class="form-check-input" 
                  (change)="fnChangePerfil($event)"
                  type="checkbox" 
                  [value]="item?.ide" 
                  [id]="item?.ide"
                  [checked]="item?.checked"
                  >
                  <label class="form-check-label" [for]="item?.ide">
                    {{item?.title}}
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="text-end mt-3">
        <button type="button" class="btn btn-secondary me-2" (click)="modal.close()">
          <!-- <i class="fa-solid fa-ban"></i> -->
          CANCELAR
        </button>

        <button type="submit" [disabled]="formData.invalid" class="btn btn-primary">
          <!-- <i class="fa-solid fa-floppy-disk"></i> -->
          GUARDAR
        </button>
      </div>
    </form>
  </div>
</div>